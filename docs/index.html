<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CertGames Architecture</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #1a1a1a;
            color: #e8e8e8;
            overflow: hidden;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100vh;
        }

        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .control-btn {
            background: #2a2a2a;
            border: 1px solid #404040;
            color: #e8e8e8;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #333;
            border-color: #505050;
        }

        #title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
        }

        #title h1 {
            color: #e8e8e8;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        #title p {
            color: #888;
            font-size: 13px;
            font-weight: 400;
        }

        #stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #404040;
            font-size: 13px;
            z-index: 10;
            min-width: 180px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }

        .stat:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .stat-label {
            color: #aaa;
            font-weight: 500;
        }

        .stat-value {
            color: #fff;
            font-weight: 600;
        }

        #breadcrumb {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2a2a2a;
            padding: 12px 24px;
            border-radius: 6px;
            border: 1px solid #404040;
            font-size: 13px;
            text-align: center;
            z-index: 10;
            max-width: 80%;
            font-family: 'Courier New', monospace;
            color: #ccc;
        }

        #tooltip {
            position: absolute;
            background: #2a2a2a;
            color: #e8e8e8;
            padding: 12px 16px;
            border-radius: 6px;
            border: 1px solid #404040;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
            z-index: 100;
            max-width: 280px;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: #2a2a2a;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #404040;
            font-size: 12px;
            z-index: 10;
        }

        .legend h3 {
            color: #e8e8e8;
            margin-bottom: 12px;
            font-size: 13px;
            font-weight: 600;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            margin-right: 8px;
            border: 1px solid #404040;
        }

        path {
            cursor: pointer;
            stroke: #1a1a1a;
            stroke-width: 1.5;
            transition: opacity 0.15s;
        }

        path:hover {
            opacity: 0.85;
        }

        .center-text {
            font-size: 14px;
            fill: #e8e8e8;
            text-anchor: middle;
            pointer-events: none;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="controls">
            <button class="control-btn" onclick="resetZoom()">Reset View</button>
            <button class="control-btn" onclick="expandAll()">Expand All</button>
        </div>

        <div id="title">
            <h1>CertGames Architecture</h1>
            <p>Click segments to zoom â€¢ Hover for details</p>
        </div>

        <div id="stats">
            <div class="stat">
                <span class="stat-label">Files</span>
                <span class="stat-value" id="file-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">Folders</span>
                <span class="stat-value" id="folder-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">Max Depth</span>
                <span class="stat-value" id="max-depth">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">Python</span>
                <span class="stat-value" id="py-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">TypeScript</span>
                <span class="stat-value" id="ts-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">React</span>
                <span class="stat-value" id="tsx-count">0</span>
            </div>
        </div>

        <div id="breadcrumb">certgames/</div>

        <div class="legend">
            <h3>File Types</h3>
            <div id="legend-items"></div>
        </div>

        <div id="tooltip"></div>
    </div>

    <script>
        // Professional color scheme
        const colors = {
            directory: '#6c9bcf',
            python: '#4b8bbe',
            typescript: '#3178c6',
            javascript: '#e4b93c',
            tsx: '#5ed3f3',
            jsx: '#5ed3f3',
            css: '#7952b3',
            scss: '#c76494',
            html: '#e44d26',
            json: '#e6b31e',
            config: '#6a737d',
            default: '#8b949e'
        };

        const fileTypeMap = {
            'py': 'python',
            'ts': 'typescript',
            'tsx': 'tsx',
            'js': 'javascript',
            'jsx': 'jsx',
            'css': 'css',
            'scss': 'scss',
            'html': 'html',
            'json': 'json',
            'yml': 'config',
            'yaml': 'config',
            'toml': 'config',
            'ini': 'config',
            'txt': 'config',
            'md': 'config'
        };

        function getFileExtension(filename) {
            if (filename === 'Makefile' || filename.startsWith('Dockerfile')) return 'config';
            const parts = filename.split('.');
            return parts.length > 1 ? parts[parts.length - 1] : '';
        }

        function getNodeColor(node) {
            if (node.data.type === 'directory') return colors.directory;
            const ext = getFileExtension(node.data.name);
            const fileType = fileTypeMap[ext] || 'default';
            return colors[fileType] || colors.default;
        }

        function calculateStats(root) {
            const stats = {
                files: 0,
                folders: 0,
                maxDepth: 0,
                py: 0,
                ts: 0,
                tsx: 0
            };

            function traverse(node, depth = 0) {
                stats.maxDepth = Math.max(stats.maxDepth, depth);
                
                if (node.data.type === 'directory') {
                    stats.folders++;
                    if (node.children) {
                        node.children.forEach(child => traverse(child, depth + 1));
                    }
                } else {
                    stats.files++;
                    const ext = getFileExtension(node.data.name);
                    if (ext === 'py') stats.py++;
                    if (ext === 'ts') stats.ts++;
                    if (ext === 'tsx') stats.tsx++;
                }
            }

            traverse(root);
            return stats;
        }

        function createLegend() {
            const legendItems = d3.select('#legend-items');
            const items = [
                { label: 'Directories', color: colors.directory },
                { label: 'Python', color: colors.python },
                { label: 'TypeScript', color: colors.typescript },
                { label: 'React', color: colors.tsx },
                { label: 'Styles', color: colors.scss },
                { label: 'Config', color: colors.config },
                { label: 'Other', color: colors.default }
            ];

            items.forEach(item => {
                const div = legendItems.append('div').attr('class', 'legend-item');
                div.append('div')
                    .attr('class', 'legend-color')
                    .style('background-color', item.color);
                div.append('span').text(item.label);
            });
        }

        let globalRoot, globalPath, globalSvg, globalArc;

        window.resetZoom = function() {
            clicked(null, globalRoot);
        }

        window.expandAll = function() {
            clicked(null, globalRoot);
        }

        // Load and visualize
        d3.json('tree.json').then(data => {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const radius = Math.min(width, height) * 0.45; // Increased from previous

            const svg = d3.select('#container')
                .append('svg')
                .attr('width', width)
                .attr('height', height)
                .append('g')
                .attr('transform', `translate(${width / 2},${height / 2})`);

            globalSvg = svg;

            const partition = d3.partition()
                .size([2 * Math.PI, radius]);

            const root = d3.hierarchy(data)
                .sum(d => d.type === 'file' ? 1 : 0)
                .sort((a, b) => b.value - a.value);

            globalRoot = root;
            partition(root);

            const stats = calculateStats(root);
            d3.select('#file-count').text(stats.files);
            d3.select('#folder-count').text(stats.folders);
            d3.select('#max-depth').text(stats.maxDepth);
            d3.select('#py-count').text(stats.py);
            d3.select('#ts-count').text(stats.ts);
            d3.select('#tsx-count').text(stats.tsx);

            createLegend();

            const arc = d3.arc()
                .startAngle(d => d.x0)
                .endAngle(d => d.x1)
                .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.003))
                .padRadius(radius / 2)
                .innerRadius(d => d.y0)
                .outerRadius(d => d.y1);

            globalArc = arc;

            const tooltip = d3.select('#tooltip');
            const breadcrumb = d3.select('#breadcrumb');

            const path = svg.selectAll('path')
                .data(root.descendants().filter(d => d.depth))
                .join('path')
                .attr('fill', getNodeColor)
                .attr('d', arc)
                .on('mouseover', function(event, d) {
                    d3.select(this).style('opacity', 0.85);
                    
                    let content = `<strong>${d.data.name}</strong><br/>`;
                    content += `Type: ${d.data.type}<br/>`;
                    content += `Depth: ${d.depth}`;
                    
                    if (d.data.type === 'directory' && d.children) {
                        content += `<br/>Items: ${d.children.length}`;
                    }
                    
                    tooltip
                        .style('opacity', 1)
                        .html(content)
                        .style('left', (event.pageX + 15) + 'px')
                        .style('top', (event.pageY - 15) + 'px');
                })
                .on('mouseout', function() {
                    d3.select(this).style('opacity', 1);
                    tooltip.style('opacity', 0);
                })
                .on('click', clicked);

            globalPath = path;

            const centerText = svg.append('text')
                .attr('class', 'center-text')
                .attr('dy', '0.35em')
                .text('certgames');

            function clicked(event, p) {
                centerText.text(p.data.name);
                
                let pathArray = [];
                let node = p;
                while (node) {
                    pathArray.unshift(node.data.name);
                    node = node.parent;
                }
                breadcrumb.text(pathArray.join(' / '));

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = svg.transition().duration(750);

                path.transition(t)
                    .tween('data', d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .attrTween('d', d => () => arc(d.current));
            }

            root.each(d => d.current = {
                x0: d.x0,
                x1: d.x1,
                y0: d.y0,
                y1: d.y1
            });
        });
    </script>
</body>
</html>
