<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CertGames Architecture - Sunburst</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            background: #0a0e27;
            color: #e0e0e0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #title {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
        }

        #title h1 {
            color: #00ff9d;
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
        }

        #title p {
            color: #888;
            font-size: 14px;
        }

        #stats {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(15, 20, 40, 0.95);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff9d;
            font-size: 13px;
            z-index: 10;
            min-width: 200px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 255, 157, 0.2);
        }

        .stat:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #00ff9d;
            font-weight: bold;
        }

        .stat-value {
            color: #fff;
        }

        #breadcrumb {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 20, 40, 0.95);
            padding: 15px 30px;
            border-radius: 10px;
            border: 2px solid #00ff9d;
            font-size: 14px;
            text-align: center;
            z-index: 10;
            max-width: 80%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: #00ff9d;
            padding: 12px 18px;
            border-radius: 8px;
            border: 2px solid #00ff9d;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 100;
            max-width: 300px;
        }

        .legend {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: rgba(15, 20, 40, 0.95);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff9d;
            font-size: 12px;
            z-index: 10;
        }

        .legend h3 {
            color: #00ff9d;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 3px;
            margin-right: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        path {
            cursor: pointer;
            stroke: #0a0e27;
            stroke-width: 2;
        }

        path:hover {
            opacity: 0.8;
        }

        .center-text {
            font-size: 16px;
            fill: #00ff9d;
            text-anchor: middle;
            pointer-events: none;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="title">
            <h1>ðŸŽ® CertGames Architecture</h1>
            <p>Click any segment to zoom â€¢ Hover for details</p>
        </div>

        <div id="stats">
            <div class="stat">
                <span class="stat-label">Total Files</span>
                <span class="stat-value" id="file-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">Directories</span>
                <span class="stat-value" id="folder-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">Max Depth</span>
                <span class="stat-value" id="max-depth">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">Python Files</span>
                <span class="stat-value" id="py-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">TypeScript</span>
                <span class="stat-value" id="ts-count">0</span>
            </div>
            <div class="stat">
                <span class="stat-label">React</span>
                <span class="stat-value" id="tsx-count">0</span>
            </div>
        </div>

        <div id="breadcrumb">certgames/</div>

        <div class="legend">
            <h3>File Types</h3>
            <div id="legend-items"></div>
        </div>

        <div id="tooltip"></div>
    </div>

    <script>
        // Color scheme
        const colors = {
            directory: '#00ff9d',
            python: '#3572A5',
            typescript: '#3178c6',
            javascript: '#f7df1e',
            tsx: '#61dafb',
            jsx: '#61dafb',
            css: '#563d7c',
            scss: '#c6538c',
            html: '#e34c26',
            json: '#ffca28',
            config: '#6e7681',
            default: '#8b949e'
        };

        const fileTypeMap = {
            'py': 'python',
            'ts': 'typescript',
            'tsx': 'tsx',
            'js': 'javascript',
            'jsx': 'jsx',
            'css': 'css',
            'scss': 'scss',
            'html': 'html',
            'json': 'json',
            'yml': 'config',
            'yaml': 'config',
            'toml': 'config',
            'ini': 'config',
            'txt': 'config',
            'md': 'config',
            'Makefile': 'config'
        };

        function getFileExtension(filename) {
            if (filename === 'Makefile' || filename === 'Dockerfile') return 'config';
            const parts = filename.split('.');
            return parts.length > 1 ? parts[parts.length - 1] : '';
        }

        function getNodeColor(node) {
            if (node.data.type === 'directory') return colors.directory;
            const ext = getFileExtension(node.data.name);
            const fileType = fileTypeMap[ext] || 'default';
            return colors[fileType] || colors.default;
        }

        function calculateStats(root) {
            const stats = {
                files: 0,
                folders: 0,
                maxDepth: 0,
                py: 0,
                ts: 0,
                tsx: 0
            };

            function traverse(node, depth = 0) {
                stats.maxDepth = Math.max(stats.maxDepth, depth);
                
                if (node.data.type === 'directory') {
                    stats.folders++;
                    if (node.children) {
                        node.children.forEach(child => traverse(child, depth + 1));
                    }
                } else {
                    stats.files++;
                    const ext = getFileExtension(node.data.name);
                    if (ext === 'py') stats.py++;
                    if (ext === 'ts') stats.ts++;
                    if (ext === 'tsx') stats.tsx++;
                }
            }

            traverse(root);
            return stats;
        }

        function createLegend() {
            const legendItems = d3.select('#legend-items');
            const items = [
                { label: 'Directory', color: colors.directory },
                { label: 'Python', color: colors.python },
                { label: 'TypeScript', color: colors.typescript },
                { label: 'React/TSX', color: colors.tsx },
                { label: 'CSS/SCSS', color: colors.scss },
                { label: 'Config', color: colors.config },
                { label: 'Other', color: colors.default }
            ];

            items.forEach(item => {
                const div = legendItems.append('div').attr('class', 'legend-item');
                div.append('div')
                    .attr('class', 'legend-color')
                    .style('background-color', item.color);
                div.append('span').text(item.label);
            });
        }

        // Load and visualize
        d3.json('tree.json').then(data => {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const radius = Math.min(width, height) / 2 - 100;

            const svg = d3.select('#container')
                .append('svg')
                .attr('width', width)
                .attr('height', height)
                .append('g')
                .attr('transform', `translate(${width / 2},${height / 2})`);

            const partition = d3.partition()
                .size([2 * Math.PI, radius]);

            const root = d3.hierarchy(data)
                .sum(d => d.type === 'file' ? 1 : 0)
                .sort((a, b) => b.value - a.value);

            partition(root);

            // Calculate stats
            const stats = calculateStats(root);
            d3.select('#file-count').text(stats.files);
            d3.select('#folder-count').text(stats.folders);
            d3.select('#max-depth').text(stats.maxDepth);
            d3.select('#py-count').text(stats.py);
            d3.select('#ts-count').text(stats.ts);
            d3.select('#tsx-count').text(stats.tsx);

            createLegend();

            const arc = d3.arc()
                .startAngle(d => d.x0)
                .endAngle(d => d.x1)
                .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
                .padRadius(radius / 2)
                .innerRadius(d => d.y0)
                .outerRadius(d => d.y1 - 1);

            const tooltip = d3.select('#tooltip');
            const breadcrumb = d3.select('#breadcrumb');

            const path = svg.selectAll('path')
                .data(root.descendants().filter(d => d.depth))
                .join('path')
                .attr('fill', getNodeColor)
                .attr('d', arc)
                .on('mouseover', function(event, d) {
                    d3.select(this).style('opacity', 0.8);
                    tooltip
                        .style('opacity', 1)
                        .html(`
                            <strong>${d.data.name}</strong><br/>
                            Type: ${d.data.type}<br/>
                            Depth: ${d.depth}<br/>
                            ${d.data.type === 'directory' ? `Children: ${d.children ? d.children.length : 0}` : ''}
                        `)
                        .style('left', (event.pageX + 15) + 'px')
                        .style('top', (event.pageY - 15) + 'px');
                })
                .on('mouseout', function() {
                    d3.select(this).style('opacity', 1);
                    tooltip.style('opacity', 0);
                })
                .on('click', clicked);

            // Center text
            const centerText = svg.append('text')
                .attr('class', 'center-text')
                .attr('dy', '0.35em')
                .text('certgames');

            function clicked(event, p) {
                centerText.text(p.data.name);
                
                // Build breadcrumb path
                let path = [];
                let node = p;
                while (node) {
                    path.unshift(node.data.name);
                    node = node.parent;
                }
                breadcrumb.text(path.join(' / '));

                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.depth),
                    y1: Math.max(0, d.y1 - p.depth)
                });

                const t = svg.transition().duration(750);

                path.transition(t)
                    .tween('data', d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .attrTween('d', d => () => arc(d.current));
            }

            root.each(d => d.current = {
                x0: d.x0,
                x1: d.x1,
                y0: d.y0,
                y1: d.y1
            });
        });
    </script>
</body>
</html>
